"use strict";var Z=Object.create;var y=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var B=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty;var $=(e,n,i,l)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of P(n))!V.call(e,o)&&o!==i&&y(e,o,{get:()=>n[o],enumerable:!(l=z(n,o))||l.enumerable});return e};var C=(e,n,i)=>(i=e!=null?Z(B(e)):{},$(n||!e||!e.__esModule?y(i,"default",{value:e,enumerable:!0}):i,e));const _=require("./index-CSvnpArE.cjs"),q=require("./index-ugE1dRs4.cjs"),r=require("react/jsx-runtime"),s=require("react"),M=require("./ActionButton-DY0olRIe.cjs"),f=require("./dialog-CVd5Mqbw.cjs"),U=require("./mitt-BqdKBRcn.cjs"),X=require("./button-BT4Gvjni.cjs"),O=require("./clsx-C11secjj.cjs"),F=require("re-resizable"),b=require("./dom-dataset-BqoJhJXt.cjs"),G=require("./utils-DmD36e1i.cjs");let L;function I(){try{return L||(L=U.mitt()),L}catch{throw new Error("Error EventEmitter")}}const D="OPEN_EXCALIDRAW_SETTING_MODAL";function Y(e,n){I().on(e,n)}function J(e,n){I().off(e,n)}function K(e){I().emit(D,e)}const Q=({editor:e})=>{const n=s.useMemo(()=>{var t;return((t=e.extensionManager.extensions.find(a=>a.name==="excalidraw"))==null?void 0:t.options)||{}},[e]),[i,l]=s.useState(null),[o,u]=s.useState({}),[g,m]=s.useState({elements:[],appState:{isLoading:!1},files:null}),[p,d]=s.useState(!1),[h,w]=s.useState(!0),[c,A]=s.useState(null),S=s.useCallback(t=>{t&&import("@excalidraw/excalidraw").then(a=>{l(a.Excalidraw)}).catch(A).finally(()=>w(!1))},[w]),j=s.useCallback(t=>{setTimeout(()=>{t.refresh()})},[]),E=s.useCallback((t,a,x)=>{u({elements:t,appState:{isLoading:!1},files:x})},[]),T=s.useCallback(()=>{if(!i){d(!1);return}e.chain().focus().setExcalidraw({data:o}).run(),d(!1)},[i,e,o,d]);return s.useEffect(()=>{const t=a=>{(a==null?void 0:a.editor)===e&&(d(!0),a&&m(a.data))};return Y(D,t),()=>{J(D,t)}},[e,d]),s.useEffect(()=>{!h&&i&&p&&setTimeout(()=>{window.dispatchEvent(new Event("resize"))},400)},[h,i,p]),r.jsxs(f.Dialog,{onOpenChange:d,open:p,children:[r.jsx(f.DialogTrigger,{asChild:!0,children:r.jsx(M.ActionButton,{action:()=>d(!0),icon:"Excalidraw",tooltip:"Excalidraw"})}),r.jsxs(f.DialogContent,{className:"richtext-z-[99999] !richtext-max-w-[1300px]",children:[r.jsx(f.DialogTitle,{children:"Excalidraw"}),r.jsxs("div",{style:{height:"100%",borderWidth:1},children:[h&&r.jsx("p",{children:"Loading..."}),c&&r.jsx("p",{children:c&&c.message||"Error"}),r.jsx("div",{ref:S,style:{width:"100%",height:600},children:!h&&!c&&i?r.jsx(i,{initialData:g,langCode:"en",onChange:E,ref:j,...n.excalidrawProps}):null})]}),r.jsx(f.DialogFooter,{children:r.jsx(X.Button,{onClick:T,type:"button",children:"Save changes"})})]})]})},ee="_wrap_15k3c_1",te="_renderWrap_15k3c_7",ne="_handlerWrap_15k3c_30",v={wrap:ee,renderWrap:te,handlerWrap:ne},re=10,se=200,R=15,W={width:"100%",height:"100%",maxWidth:"100%"};function ae({editor:e,node:n,updateAttributes:i}){const l=s.useRef(null),o=e.isActive(H.name),{data:u,width:g,height:m}=n.attrs,[p,d]=s.useState(null),[h,w]=s.useState(!0),[c,A]=s.useState(null),[S,j]=s.useState(100),E=s.useCallback(t=>()=>{j(a=>G.clamp(t==="minus"?a-R:a+R,re,se))},[]);s.useEffect(()=>{let t=!1;return import("@excalidraw/excalidraw").then(a=>{t||(l.current=a.exportToSvg)}).catch(a=>!t&&A(a)).finally(()=>!t&&w(!1)),()=>{t=!0}},[u]),s.useEffect(()=>{let t=!1;return(async()=>{if(!l.current||t||h||c||!u)return;const x=await l.current(u);t||(x.setAttribute("width","100%"),x.setAttribute("height","100%"),x.setAttribute("display","block"),d(x))})(),()=>{t=!0}},[u,h,c]);const T=t=>{i({width:t.width,height:t.height})};return r.jsx(q.NodeViewWrapper,{className:O.clsx(v.wrap,o&&v.isActive),children:r.jsx(F.Resizable,{size:{width:Number.parseInt(g),height:Number.parseInt(m)},onResizeStop:(t,a,x,N)=>{T({width:Number.parseInt(g)+N.width,height:Number.parseInt(m)+N.height})},children:r.jsxs("div",{className:O.clsx(v.renderWrap,"render-wrapper"),style:{...W,overflow:"hidden"},children:[c&&r.jsx("div",{style:W,children:r.jsx("p",{children:c.message||c})}),h&&r.jsx("p",{children:"Loading..."}),!h&&!c&&p&&r.jsx("div",{dangerouslySetInnerHTML:{__html:(p==null?void 0:p.outerHTML)??""},style:{height:"100%",maxHeight:"100%",padding:24,overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center",transform:`scale(${S/100})`,transition:"all ease-in-out .3s"}}),r.jsxs("div",{className:v.handlerWrap,children:[r.jsx(M.ActionButton,{action:E("minus"),icon:"ZoomOut",tooltip:"Zoom Out"}),r.jsx(M.ActionButton,{action:E("plus"),icon:"ZoomIn",tooltip:"Zoom In"})]})]})})})}const k={elements:[]},H=_.Node.create({name:"excalidraw",group:"block",selectable:!0,atom:!0,draggable:!0,inline:!1,addAttributes(){return{defaultShowPicker:{default:!1},createUser:{default:null},width:{default:"100%",parseHTML:b.getDatasetAttribute("width")},height:{default:240,parseHTML:b.getDatasetAttribute("height")},data:{default:k,parseHTML:b.getDatasetAttribute("data",!0)}}},addOptions(){var e;return{...(e=this.parent)==null?void 0:e.call(this),HTMLAttributes:{class:"excalidraw"},excalidrawProps:{},button:({editor:n})=>({component:Q,componentProps:{editor:n}})}},parseHTML(){return[{tag:"div[class=excalidraw]"}]},renderHTML({HTMLAttributes:e,node:n}){return["div",_.mergeAttributes(this.options.HTMLAttributes,e,b.nodeAttrsToDataset(n))]},addCommands(){return{setExcalidraw:e=>({tr:n,commands:i,chain:l})=>{var o,u,g;return e=e||{},e.data=e.data||k,((g=(u=(o=n.selection)==null?void 0:o.node)==null?void 0:u.type)==null?void 0:g.name)==this.name?i.updateAttributes(this.name,e):l().insertContent({type:this.name,attrs:e}).run()}}},addNodeView(){return q.ReactNodeViewRenderer(ae)},addInputRules(){return[_.nodeInputRule({find:/^\$excalidraw\$$/,type:this.type,getAttributes:()=>({width:"100%"})})]}});exports.Excalidraw=H;exports.triggerOpenExcalidrawSettingModal=K;
