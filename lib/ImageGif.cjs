"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const B=require("./index-CSvnpArE.cjs"),P=require("./index-DBoalRcu.cjs"),H=require("./index-ugE1dRs4.cjs"),s=require("react/jsx-runtime"),a=require("react"),F=require("./ActionButton-DY0olRIe.cjs"),W=require("./debounce-DGq84Kwn.cjs"),O=require("./popover-C53Gavq8.cjs"),D=require("./input-8Tv6i4jL.cjs"),I=require("./index-CWKNKm3Y.cjs"),L=require("./isNumber-CCe5ja6q.cjs");function Y({selectImage:e,giphyApiKey:t,children:n}){const[c,f]=a.useState([]),[g]=a.useState(15),d=a.useRef(null),v=(o,E="search")=>{if(!t)return;const M=`${E==="search"?`https://api.giphy.com/v1/gifs/search?q=${o}`:`https://api.giphy.com/v1/gifs/trending?q=${o}`}&limit=${g}&api_key=${t}`;fetch(M).then(w=>w.json()).then(w=>{f(w.data)}).catch(w=>{console.log(w)})};a.useEffect(()=>{v("","trend")},[]);const T=a.useCallback(W.debounce(o=>{if(!o.target.value){v("","trend");return}v(o.target.value)},350),[]);return s.jsxs(O.Popover,{modal:!0,children:[s.jsx(O.PopoverTrigger,{asChild:!0,children:n}),s.jsx(O.PopoverContent,{align:"start",className:"richtext-size-full richtext-p-2",hideWhenDetached:!0,side:"bottom",children:t?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"richtext-mb-[10px] richtext-w-full",children:s.jsx(D.Input,{onChange:T,placeholder:"Search GIF",ref:d,type:"text"})}),s.jsx("div",{className:"richtext-max-h-[280px] richtext-overflow-y-auto",children:s.jsx("div",{className:"richtext-grid richtext-grid-cols-2 richtext-gap-1 ",children:c!=null&&c.length?c==null?void 0:c.map(o=>s.jsx("img",{alt:"giphy",className:"richtext-cursor-pointer richtext-text-center",height:o.images.fixed_width_downsampled.height,onClick:()=>e(o),src:o.images.fixed_width_downsampled.url,width:o.images.fixed_width_downsampled.width},`giphy-${o.id}`)):s.jsx("p",{children:"No GIFs found"})})})]}):s.jsx("div",{children:s.jsx("p",{children:"Missing Giphy API Key"})})})]})}function V({editor:e,icon:t,giphyApiKey:n,...c}){const f=g=>{const{url:d}=g.images.original;e.chain().focus().setImageGif({src:d}).run()};return s.jsx(Y,{giphyApiKey:n,selectImage:f,children:s.jsx(F.ActionButton,{icon:t,tooltip:c==null?void 0:c.tooltip})})}const G={TOP_LEFT:"tl",TOP_RIGHT:"tr",BOTTOM_LEFT:"bl",BOTTOM_RIGHT:"br"};function X(e){var z,C;const[t,n]=a.useState({width:I.IMAGE_MAX_SIZE,height:I.IMAGE_MAX_SIZE}),[c,f]=a.useState({width:0,height:0}),[g]=a.useState([G.TOP_LEFT,G.TOP_RIGHT,G.BOTTOM_LEFT,G.BOTTOM_RIGHT]),[d,v]=a.useState(!1),[T,o]=a.useState({x:0,y:0,w:0,h:0,dir:""}),{align:E}=(z=e==null?void 0:e.node)==null?void 0:z.attrs,_=a.useMemo(()=>{var h;const{src:i,alt:u,width:l,height:x}=(h=e==null?void 0:e.node)==null?void 0:h.attrs,b=L.isNumber(l)?`${l}px`:l,r=L.isNumber(x)?`${x}px`:x;return{src:i||void 0,alt:u||void 0,style:{width:b||void 0,height:r||void 0}}},[(C=e==null?void 0:e.node)==null?void 0:C.attrs]),M=a.useMemo(()=>{const{style:{width:i}}=_;return{width:i==="100%"?i:void 0}},[_]);function w(i){f({width:i.target.width,height:i.target.height})}function N(){const{editor:i,getPos:u}=e;i.commands.setNodeSelection(u())}const R=a.useCallback(P.throttle(()=>{const{editor:i}=e,{width:u}=getComputedStyle(i.view.dom);n(l=>({...l,width:Number.parseInt(u,10)}))},I.IMAGE_THROTTLE_WAIT_TIME),[e==null?void 0:e.editor]);function k(i,u){i.preventDefault(),i.stopPropagation();const l=c.width,x=c.height,b=l/x;let r=Number(e.node.attrs.width),h=Number(e.node.attrs.height);const m=t.width;r&&!h?(r=r>m?m:r,h=Math.round(r/b)):h&&!r?(r=Math.round(h*b),r=r>m?m:r):!r&&!h?(r=l>m?m:l,h=Math.round(r/b)):r=r>m?m:r,v(!0),o({x:i.clientX,y:i.clientY,w:r,h,dir:u})}const A=a.useCallback(P.throttle(i=>{if(i.preventDefault(),i.stopPropagation(),!d)return;const{x:u,w:l,dir:x}=T,b=(i.clientX-u)*(/l/.test(x)?-1:1),r=L.clamp(l+b,I.IMAGE_MIN_SIZE,t.width);e.updateAttributes({width:r,height:null})},I.IMAGE_THROTTLE_WAIT_TIME),[d,T,t,e.updateAttributes]),y=a.useCallback(i=>{i.preventDefault(),i.stopPropagation(),d&&(o({x:0,y:0,w:0,h:0,dir:""}),v(!1),N())},[d,N]),$=a.useCallback(()=>{document==null||document.addEventListener("mousemove",A,!0),document==null||document.addEventListener("mouseup",y,!0)},[A,y]),S=a.useCallback(()=>{document==null||document.removeEventListener("mousemove",A,!0),document==null||document.removeEventListener("mouseup",y,!0)},[A,y]);a.useEffect(()=>(d?$():S(),()=>{S()}),[d,$,S]);const j=a.useMemo(()=>new ResizeObserver(()=>R()),[R]);return a.useEffect(()=>(j.observe(e.editor.view.dom),()=>{j.disconnect()}),[e.editor.view.dom,j]),s.jsx(H.NodeViewWrapper,{className:"image-view",style:{...M,width:"100%",textAlign:E},children:s.jsxs("div",{"data-drag-handle":!0,draggable:"true",style:M,className:`image-view__body ${e!=null&&e.selected?"image-view__body--focused":""} ${d?"image-view__body--resizing":""}`,children:[s.jsx("img",{alt:_.alt,className:"image-view__body__image block",height:"auto",onClick:N,onLoad:w,src:_.src,style:_.style}),(e==null?void 0:e.editor.view.editable)&&((e==null?void 0:e.selected)||d)&&s.jsx("div",{className:"image-resizer",children:g==null?void 0:g.map(i=>s.jsx("span",{className:`image-resizer__handler image-resizer__handler--${i}`,onMouseDown:u=>k(u,i)},`image-dir-${i}`))})]})})}const q=P.Image.extend({name:"imageGif",addOptions(){var e;return{...(e=this.parent)==null?void 0:e.call(this),inline:!1,content:"",marks:"",group:"block",GIPHY_API_KEY:"",draggable:!1,selectable:!0,atom:!0,button:({editor:t,extension:n,t:c})=>{var g;const f=((g=n==null?void 0:n.options)==null?void 0:g.GIPHY_API_KEY)||"";return{component:V,componentProps:{editor:t,action:()=>{},isActive:()=>!1,disabled:!1,icon:"GifIcon",tooltip:c("editor.imageGif.tooltip"),giphyApiKey:f}}}}},addAttributes(){var e;return{...(e=this.parent)==null?void 0:e.call(this),width:{default:null,parseHTML:t=>{const n=t.style.width||t.getAttribute("width")||"10";return n===void 0?null:Number.parseInt(`${n}`,10)},renderHTML:t=>({width:t.width})},align:{default:"center",parseHTML:t=>t.getAttribute("align"),renderHTML:t=>({align:t.align})}}},addNodeView(){return H.ReactNodeViewRenderer(X)},addCommands(){var e;return{...(e=this.parent)==null?void 0:e.call(this),setImageGif:t=>({commands:n})=>n.insertContent({type:this.name,attrs:t}),updateImageGif:t=>({commands:n})=>n.updateAttributes(this.name,t),setAlignImageGif:t=>({commands:n})=>n.updateAttributes(this.name,{align:t})}},renderHTML({HTMLAttributes:e}){const{align:t}=e;return["div",{style:t?`text-align: ${t};`:"",class:"imageGIf"},["img",B.mergeAttributes({height:"auto"},this.options.HTMLAttributes,e)]]},parseHTML(){return[{tag:"div[class=imageGIf]",getAttrs:e=>{const t=e.querySelector("img"),n=t==null?void 0:t.getAttribute("width");return{src:t==null?void 0:t.getAttribute("src"),alt:t==null?void 0:t.getAttribute("alt"),title:t==null?void 0:t.getAttribute("title"),width:n?Number.parseInt(n,10):null,align:(t==null?void 0:t.getAttribute("align"))||e.style.textAlign||null}}}]}});exports.ImageGif=q;exports.default=q;
