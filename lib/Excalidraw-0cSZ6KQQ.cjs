"use strict";var W=Object.create;var N=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var P=(e,n,i,l)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of Z(n))!z.call(e,o)&&o!==i&&N(e,o,{get:()=>n[o],enumerable:!(l=H(n,o))||l.enumerable});return e};var y=(e,n,i)=>(i=e!=null?W(q(e)):{},P(n||!e||!e.__esModule?N(i,"default",{value:e,enumerable:!0}):i,e));const _=require("./index-CSvnpArE.cjs"),x=require("./dom-dataset-Cuy-pIfj.cjs"),r=require("react/jsx-runtime"),a=require("react"),u=require("./RichTextEditor-CiHu3qws.cjs"),B=require("./index-C19MB4Al.cjs"),V=require("re-resizable");let L;function D(){try{return L||(L=B.mitt()),L}catch{throw new Error("Error EventEmitter")}}const M="OPEN_EXCALIDRAW_SETTING_MODAL";function $(e,n){D().on(e,n)}function U(e,n){D().off(e,n)}function X(e){D().emit(M,e)}const F=({editor:e})=>{const n=a.useMemo(()=>{var t;return((t=e.extensionManager.extensions.find(s=>s.name==="excalidraw"))==null?void 0:t.options)||{}},[e]),[i,l]=a.useState(null),[o,d]=a.useState({}),[f,m]=a.useState({elements:[],appState:{isLoading:!1},files:null}),[g,h]=a.useState(!1),[p,E]=a.useState(!0),[c,A]=a.useState(null),S=a.useCallback(t=>{t&&import("@excalidraw/excalidraw").then(s=>{l(s.Excalidraw)}).catch(A).finally(()=>E(!1))},[E]),j=a.useCallback(t=>{setTimeout(()=>{t.refresh()})},[]),b=a.useCallback((t,s,w)=>{d({elements:t,appState:{isLoading:!1},files:w})},[]),T=a.useCallback(()=>{if(!i){h(!1);return}e.chain().focus().setExcalidraw({data:o}).run(),h(!1)},[i,e,o,h]);return a.useEffect(()=>{const t=s=>{(s==null?void 0:s.editor)===e&&(h(!0),s&&m(s.data))};return $(M,t),()=>{U(M,t)}},[e,h]),a.useEffect(()=>{!p&&i&&g&&setTimeout(()=>{window.dispatchEvent(new Event("resize"))},400)},[p,i,g]),r.jsxs(u.Dialog,{onOpenChange:h,open:g,children:[r.jsx(u.DialogTrigger,{asChild:!0,children:r.jsx(u.ActionButton,{action:()=>h(!0),icon:"Excalidraw",tooltip:"Excalidraw"})}),r.jsxs(u.DialogContent,{className:"richtext-z-[99999] !richtext-max-w-[1300px]",children:[r.jsx(u.DialogTitle,{children:"Excalidraw"}),r.jsxs("div",{style:{height:"100%",borderWidth:1},children:[p&&r.jsx("p",{children:"Loading..."}),c&&r.jsx("p",{children:c&&c.message||"Error"}),r.jsx("div",{ref:S,style:{width:"100%",height:600},children:!p&&!c&&i?r.jsx(i,{initialData:f,langCode:"en",onChange:b,ref:j,...n.excalidrawProps}):null})]}),r.jsx(u.DialogFooter,{children:r.jsx(u.Button,{onClick:T,type:"button",children:"Save changes"})})]})]})},G="_wrap_15k3c_1",Y="_renderWrap_15k3c_7",J="_handlerWrap_15k3c_30",v={wrap:G,renderWrap:Y,handlerWrap:J},K=10,Q=200,C=15,O={width:"100%",height:"100%",maxWidth:"100%"};function ee({editor:e,node:n,updateAttributes:i}){const l=a.useRef(null),o=e.isActive(k.name),{data:d,width:f,height:m}=n.attrs,[g,h]=a.useState(null),[p,E]=a.useState(!0),[c,A]=a.useState(null),[S,j]=a.useState(100),b=a.useCallback(t=>()=>{j(s=>u.clamp(t==="minus"?s-C:s+C,K,Q))},[]);a.useEffect(()=>{let t=!1;return import("@excalidraw/excalidraw").then(s=>{t||(l.current=s.exportToSvg)}).catch(s=>!t&&A(s)).finally(()=>!t&&E(!1)),()=>{t=!0}},[d]),a.useEffect(()=>{let t=!1;return(async()=>{if(!l.current||t||p||c||!d)return;const w=await l.current(d);t||(w.setAttribute("width","100%"),w.setAttribute("height","100%"),w.setAttribute("display","block"),h(w))})(),()=>{t=!0}},[d,p,c]);const T=t=>{i({width:t.width,height:t.height})};return r.jsx(x.NodeViewWrapper,{className:x.clsx(v.wrap,o&&v.isActive),children:r.jsx(V.Resizable,{size:{width:Number.parseInt(f),height:Number.parseInt(m)},onResizeStop:(t,s,w,I)=>{T({width:Number.parseInt(f)+I.width,height:Number.parseInt(m)+I.height})},children:r.jsxs("div",{className:x.clsx(v.renderWrap,"render-wrapper"),style:{...O,overflow:"hidden"},children:[c&&r.jsx("div",{style:O,children:r.jsx("p",{children:c.message||c})}),p&&r.jsx("p",{children:"Loading..."}),!p&&!c&&g&&r.jsx("div",{dangerouslySetInnerHTML:{__html:(g==null?void 0:g.outerHTML)??""},style:{height:"100%",maxHeight:"100%",padding:24,overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center",transform:`scale(${S/100})`,transition:"all ease-in-out .3s"}}),r.jsxs("div",{className:v.handlerWrap,children:[r.jsx(u.ActionButton,{action:b("minus"),icon:"ZoomOut",tooltip:"Zoom Out"}),r.jsx(u.ActionButton,{action:b("plus"),icon:"ZoomIn",tooltip:"Zoom In"})]})]})})})}const R={elements:[]},k=_.Node.create({name:"excalidraw",group:"block",selectable:!0,atom:!0,draggable:!0,inline:!1,addAttributes(){return{defaultShowPicker:{default:!1},createUser:{default:null},width:{default:"100%",parseHTML:x.getDatasetAttribute("width")},height:{default:240,parseHTML:x.getDatasetAttribute("height")},data:{default:R,parseHTML:x.getDatasetAttribute("data",!0)}}},addOptions(){var e;return{...(e=this.parent)==null?void 0:e.call(this),HTMLAttributes:{class:"excalidraw"},excalidrawProps:{},button:({editor:n})=>({component:F,componentProps:{editor:n}})}},parseHTML(){return[{tag:"div[class=excalidraw]"}]},renderHTML({HTMLAttributes:e,node:n}){return["div",_.mergeAttributes(this.options.HTMLAttributes,e,x.nodeAttrsToDataset(n))]},addCommands(){return{setExcalidraw:e=>({tr:n,commands:i,chain:l})=>{var o,d,f;return e=e||{},e.data=e.data||R,((f=(d=(o=n.selection)==null?void 0:o.node)==null?void 0:d.type)==null?void 0:f.name)==this.name?i.updateAttributes(this.name,e):l().insertContent({type:this.name,attrs:e}).run()}}},addNodeView(){return x.ReactNodeViewRenderer(ee)},addInputRules(){return[_.nodeInputRule({find:/^\$excalidraw\$$/,type:this.type,getAttributes:()=>({width:"100%"})})]}});exports.Excalidraw=k;exports.triggerOpenExcalidrawSettingModal=X;
