"use strict";var Y=Object.create;var K=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var re=Object.getPrototypeOf,ne=Object.prototype.hasOwnProperty;var ie=(e,n,s,a)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of te(n))!ne.call(e,i)&&i!==s&&K(e,i,{get:()=>n[i],enumerable:!(a=ee(n,i))||a.enumerable});return e};var se=(e,n,s)=>(s=e!=null?Y(re(e)):{},ie(n||!e||!e.__esModule?K(s,"default",{value:e,enumerable:!0}):s,e));Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t=require("react/jsx-runtime"),o=require("react"),T=require("./index-ugE1dRs4.cjs"),U=require("./Mermaid.cjs"),I=require("./shortId-Bfj8TyNr.cjs"),j=require("./ActionButton-DY0olRIe.cjs"),w=require("./dialog-CVd5Mqbw.cjs"),G=require("./textarea-BYF4nPuF.cjs"),Z=require("./file-i7e4nQY2.cjs"),R=require("./button-BT4Gvjni.cjs"),N=require("./theme-DvNbe4l0.cjs"),D=require("./index-BObJ0_Vs.cjs"),$=require("./SizeSetter-DayMluAF.cjs"),J=require("./separator-B3F4FNZb.cjs"),C=require("./Excalidraw-C9PUYv2_.cjs"),H=require("./delete-node-CosiBes5.cjs"),F=require("./Twitter-ByweDcD1.cjs"),oe=require("katex"),O=require("lucide-react"),E=require("./Katex.cjs"),L=require("./Drawer-DS5BI9jk.cjs"),V=require("easydrawer"),_=`graph TB
a-->b`,ae=({editor:e,attrs:n,extension:s})=>{const{alt:a,align:i}=n,[r,c]=o.useState(decodeURIComponent(a??_)),[d,h]=o.useState(""),[m,f]=o.useState(!1),g=o.useRef(null),[b,S]=o.useState(null),M=s==null?void 0:s.options.upload,A=o.useCallback(p=>{p&&import("mermaid").then(v=>{S(v.default)})},[]),B=async p=>{try{const{svg:v}=await b.render("mermaid-svg",p);h(v)}catch{h("")}},q=()=>{b.initialize({darkMode:!1,startOnLoad:!1,fontSize:12,theme:"base"}),B(r)};o.useEffect(()=>{b&&m&&q()},[b,m]),o.useEffect(()=>{b&&m&&B(r)},[b,r]);const z=async()=>{if(r!==""){if(r){const p=g.current.querySelector("svg"),{width:v,height:P}=p.getBoundingClientRect(),x=`mermaid-${I.shortId()}.svg`;let l=I.i(p.outerHTML);if(M){const u=Z.dataURLtoFile(l,x);l=await M(u)}e==null||e.chain().focus().setMermaid({type:"mermaid",src:l,alt:encodeURIComponent(r),width:v,height:P},!!r).run(),e==null||e.commands.setAlignImageMermaid(i)}f(!1)}};return t.jsxs(w.Dialog,{onOpenChange:f,open:m,children:[t.jsx(w.DialogTrigger,{asChild:!0,children:t.jsx(j.ActionButton,{action:()=>f(!0),icon:"Pencil",tooltip:"Edit Mermaid"})}),t.jsxs(w.DialogContent,{className:"richtext-z-[99999] !richtext-max-w-[1300px]",children:[t.jsx(w.DialogTitle,{children:"Edit Mermaid"}),t.jsx("div",{ref:A,style:{height:"100%",border:"1px solid hsl(var(--border))"},children:t.jsxs("div",{className:"richtext-flex richtext-gap-[10px] richtext-rounded-[10px] richtext-p-[10px]",children:[t.jsx(G.Textarea,{autoFocus:!0,className:"richtext-flex-1",defaultValue:_,onChange:p=>c(p.target.value),placeholder:"Text",required:!0,rows:10,value:r,style:{color:"hsl(var(--richtext-foreground))"}}),t.jsx("div",{className:"richtext-flex richtext-flex-1 richtext-items-center richtext-justify-center richtext-rounded-[10px] richtext-p-[10px]",dangerouslySetInnerHTML:{__html:d},ref:g,style:{height:"100%",border:"1px solid hsl(var(--border))",minHeight:500,background:"#fff"}})]})}),t.jsx(w.DialogFooter,{children:t.jsx(R.Button,{onClick:z,type:"button",children:"Save changes"})})]})]})};function Q(e,n){const[s,a]=o.useState(void 0);return o.useEffect(()=>{const i=()=>{const r=e.extensionManager.extensions.find(c=>c.name===n);r&&a(r)};return e.on("selectionUpdate",i),e.on("transaction",i),()=>{e.off("selectionUpdate",i),e.off("transaction",i)}},[e,n]),s}const ce={maxWidth:"auto",zIndex:20,appendTo:"parent",moveTransition:"transform 0.1s ease-out"};function le({item:e,disabled:n,editor:s}){var i;const a=e.component;return a?t.jsx(o.Fragment,{children:e.type==="divider"?t.jsx(J.Separator,{className:"!richtext-mx-1 !richtext-my-2 !richtext-h-[16px]",orientation:"vertical"}):t.jsx(a,{...e.componentProps,disabled:n||((i=e==null?void 0:e.componentProps)==null?void 0:i.disabled),editor:s})}):t.jsx(t.Fragment,{})}function de(e){return e.type.name==="mermaid"}function ue(e){const{lang:n}=D.useLocale(),s=N.useAttributes(e.editor,U.Mermaid.name),a=Q(e.editor,U.Mermaid.name),i=({editor:c})=>{const{selection:d}=c.view.state,{$from:h,to:m}=d;let f=!1;return c.view.state.doc.nodesBetween(h.pos,m,g=>{if(de(g))return f=!0,!1}),f},r=o.useMemo(()=>e.disabled?[]:$.getBubbleMermaid(e.editor),[e.disabled,e.editor,n]);return t.jsx(t.Fragment,{children:t.jsx(T.BubbleMenu,{editor:e==null?void 0:e.editor,shouldShow:i,tippyOptions:ce,children:r!=null&&r.length?t.jsx("div",{className:"richtext-pointer-events-auto richtext-w-auto richtext-select-none richtext-rounded-sm !richtext-border richtext-border-neutral-200 richtext-bg-background richtext-px-3 richtext-py-2 richtext-shadow-sm richtext-transition-all dark:richtext-border-neutral-800",children:t.jsx("div",{className:"richtext-relative richtext-flex richtext-h-[26px] richtext-flex-nowrap richtext-items-center richtext-justify-start richtext-whitespace-nowrap",children:r==null?void 0:r.map((c,d)=>c.type==="edit"&&(s!=null&&s.src)?t.jsx(ae,{attrs:s,editor:e.editor,extension:a},`bubbleMenu-mermaid-${d}`):t.jsx(le,{disabled:e.disabled,editor:e.editor,item:c},`bubbleMenu-mermaid-${d}`))})}):t.jsx(t.Fragment,{})})})}const y=new Map;function he(e){const n=e.options.element;y.has("width")||y.set("width",n.clientWidth),y.has("width")&&y.get("width")<=0&&y.set("width",n.clientWidth);const s={attributes:!0,childList:!0,subtree:!0},a=function(){y.set("width",n.clientWidth)},i=new MutationObserver(a);return i.observe(n,s),e.on("destroy",()=>{i.disconnect()}),{width:y.get("width")}}function xe({editor:e}){const{t:n}=D.useLocale(),{width:s}=he(e),a=N.useAttributes(e,C.Excalidraw.name,{defaultShowPicker:!1,createUser:"",width:0,height:0}),{defaultShowPicker:i,createUser:r,width:c,height:d}=a,h=o.useCallback(b=>{e.chain().updateAttributes(C.Excalidraw.name,b).setNodeSelection(e.state.selection.from).focus().run()},[e]),m=o.useCallback(()=>{C.triggerOpenExcalidrawSettingModal({...a,editor:e})},[e,a]),f=o.useCallback(()=>e.isActive(C.Excalidraw.name),[e]),g=o.useCallback(()=>H.deleteNode(C.Excalidraw.name,e),[e]);return o.useEffect(()=>{i&&(m(),e.chain().updateAttributes(C.Excalidraw.name,{defaultShowPicker:!1}).focus().run())},[r,i,e,m]),t.jsx(T.BubbleMenu,{className:"bubble-menu",editor:e,pluginKey:"excalidraw-bubble-menu",shouldShow:f,tippyOptions:{popperOptions:{modifiers:[{name:"flip",enabled:!1}]},placement:"bottom-start",offset:[-2,16],zIndex:9999},children:t.jsxs("div",{className:"richtext-w-auto richtext-px-3 richtext-py-2 richtext-transition-all !richtext-border richtext-rounded-sm richtext-shadow-sm richtext-pointer-events-auto richtext-select-none richtext-border-neutral-200 dark:richtext-border-neutral-800 richtext-bg-background",children:[t.jsx(j.ActionButton,{icon:"Pencil",action:m,tooltip:n("editor.edit")}),t.jsx($.SizeSetter,{width:c,maxWidth:s,height:d,onOk:h,children:t.jsx(j.ActionButton,{icon:"Settings",tooltip:n("editor.settings")})}),t.jsx(j.ActionButton,{icon:"Trash2",action:g,tooltip:n("editor.delete")})]})})}function me({editor:e,disabled:n}){const[s,a]=o.useState(!1),{t:i}=D.useLocale(),r=o.useCallback(({editor:h})=>h.isActive(F.Twitter.name),[]),c=h=>{e.commands.updateTweet({src:h}),a(!1)},d=o.useCallback(()=>H.deleteNode(F.Twitter.name,e),[e]);return t.jsx(t.Fragment,{children:t.jsx(T.BubbleMenu,{editor:e,shouldShow:r,tippyOptions:{popperOptions:{modifiers:[{name:"flip",enabled:!1}]},placement:"bottom-start",offset:[-2,16],zIndex:9999,onHidden:()=>{a(!1)}},children:n?t.jsx(t.Fragment,{}):t.jsx(t.Fragment,{children:s?t.jsx(F.FormEditLinkTwitter,{editor:e,onSetLink:c}):t.jsx("div",{className:"richtext-flex richtext-items-center richtext-gap-2 richtext-rounded-lg !richtext-border richtext-border-neutral-200 richtext-bg-white richtext-p-2 richtext-shadow-sm dark:richtext-border-neutral-800 dark:richtext-bg-black",children:t.jsxs("div",{className:"richtext-flex richtext-flex-nowrap",children:[t.jsx(j.ActionButton,{icon:"Pencil",tooltip:i("editor.link.edit.tooltip"),tooltipOptions:{sideOffset:15},action:()=>{a(!0)}}),t.jsx(j.ActionButton,{action:d,icon:"Trash",tooltip:i("editor.delete"),tooltipOptions:{sideOffset:15}})]})})})})})}function fe({editor:e,...n}){const s=N.useAttributes(e,E.Katex.name,{text:"",defaultShowPicker:!1}),{text:a,defaultShowPicker:i}=s,[r,c]=o.useState(""),[d,h]=o.useState(!1),m=o.useCallback(()=>e.isActive(E.Katex.name),[e]),f=o.useCallback(()=>H.deleteNode(E.Katex.name,e),[e]),g=o.useCallback(()=>{e.chain().focus().setKatex({text:r}).run(),h(!1)},[e,r]);o.useEffect(()=>{i&&(h(!0),e.chain().updateAttributes(E.Katex.name,{defaultShowPicker:!1}).focus().run())},[e,i,h]),o.useEffect(()=>{d&&c(a||"")},[d]);const b=o.useMemo(()=>{try{return oe.renderToString(`${r}`)}catch{return r}},[r]),S=o.useMemo(()=>`${r}`.trim()?t.jsx("span",{contentEditable:!1,dangerouslySetInnerHTML:{__html:b||""}}):null,[r,b]);return t.jsx(T.BubbleMenu,{editor:e,pluginKey:"Katex-bubble-menu",shouldShow:m,tippyOptions:{popperOptions:{modifiers:[{name:"flip",enabled:!1}]},placement:"bottom-start",offset:[-2,16],zIndex:9999,onHidden:()=>{h(!1)}},children:n!=null&&n.disabled?t.jsx(t.Fragment,{}):t.jsx("div",{className:"richtext-rounded-lg !richtext-border richtext-border-neutral-200 richtext-bg-white richtext-p-2 richtext-shadow-sm dark:richtext-border-neutral-800 dark:richtext-bg-black",children:d?t.jsxs(t.Fragment,{children:[t.jsx(G.Textarea,{autoFocus:!0,defaultValue:a,onChange:M=>c(M.target.value),placeholder:"Formula text",rows:3,style:{marginBottom:8},value:r}),S&&t.jsx("div",{className:"richtext-my-[10px] richtext-overflow-auto richtext-whitespace-nowrap richtext-rounded-[6px] !richtext-border richtext-p-[10px]",children:S}),t.jsxs("div",{className:"richtext-flex richtext-items-center richtext-justify-between richtext-gap-[6px]",children:[t.jsx(R.Button,{className:"richtext-flex-1",onClick:g,children:"Submit"}),t.jsx("a",{href:"https://katex.org/docs/supported",rel:"noreferrer noopener",target:"_blank",children:t.jsx(O.HelpCircle,{size:16})})]})]}):t.jsxs("div",{className:"richtext-flex richtext-items-center richtext-justify-center richtext-gap-[6px]",children:[t.jsx(j.ActionButton,{action:()=>h(!d),tooltip:"Edit",children:t.jsx(O.Pencil,{size:16})}),t.jsx(j.ActionButton,{action:f,tooltip:"Delete",children:t.jsx(O.Trash2,{size:16})})]})})})}let k=!1;function be({editor:e,attrs:n,extension:s}){const[a,i]=o.useState(!1),r=o.useRef(null),c=o.useRef(null),{alt:d,align:h}=n,m=s==null?void 0:s.options.upload,f=()=>{(async()=>{const l=document.querySelector("#easydrawer");l&&(r.current=new V.Editor(l,{wheelEventsEnabled:!1,disableZoom:!0}),c.current=V.makeDropdownToolbar(r.current),c.current.addDefaultToolWidgets(),r.current.loadFromSVG(decodeURIComponent(d)))})()};o.useEffect(()=>{a&&setTimeout(()=>{f()},200)},[a]);const g=async()=>{if(r.current){const x=r.current.toSVG(),l=x.outerHTML,u=`drawer-${I.shortId()}.svg`;let W=I.i(x.outerHTML);if(m){const X=Z.dataURLtoFile(W,u);W=await m(X)}e==null||e.chain().focus().setDrawer({type:"drawer",src:W,alt:encodeURIComponent(l),width:426,height:212},!!l).run(),e==null||e.commands.setAlignImageDrawer(h)}i(!1)},b=x=>{const l=r.current.toolController.getPrimaryTools()[2],u=c.current.getWidgetById("pen-1");l&&u&&(l.setColor(x),u.serializeState())},S=x=>{const l=r.current.toolController.getPrimaryTools()[2],u=c.current.getWidgetById("pen-1");l&&u&&(l.setThickness(x),u.serializeState())},M=x=>{const l=r.current.toolController.getPrimaryTools()[3],u=c.current.getWidgetById("pen-2");l&&u&&(l.setColor(x),u.serializeState())},A=x=>{const l=c.current.getWidgetById("shape");l&&l.setShapeType(x)},B=x=>{const l=r.current.toolController.getPrimaryTools()[5],u=c.current.getWidgetById("shape");l&&u&&(l.setColor(x),u.serializeState())},q=x=>{const l=r.current.toolController.getPrimaryTools()[5],u=c.current.getWidgetById("shape");l&&u&&(l.setThickness(x),u.serializeState())},z=x=>{const l=r.current.toolController.getPrimaryTools()[5],u=c.current.getWidgetById("shape");l&&u&&(l.setBorderColor(x),u.serializeState())},p=()=>{if(k){for(;r.current.history.redoStackSize>0;)r.current.history.redo();k=!1;return}r.current.history.undo()},v=()=>{k||r.current.history.redo()},P=()=>{if(!k){for(;r.current.history.undoStackSize>0;)p();k=!0}};return t.jsxs(w.Dialog,{onOpenChange:i,open:a,children:[t.jsx(w.DialogTrigger,{asChild:!0,children:t.jsx(j.ActionButton,{action:()=>i(!0),icon:"Pencil",tooltip:"Edit Drawer"})}),t.jsxs(w.DialogContent,{className:"richtext-z-[99999] !richtext-max-w-[1300px]",children:[t.jsx(w.DialogTitle,{children:"Edit Drawer"}),t.jsxs("div",{style:{height:"100%",borderWidth:1,background:"white",position:"relative"},children:[t.jsx("div",{className:"richtext-size-full",id:"easydrawer"}),t.jsx(L.ControlDrawer,{changeBorderColorShape:z,changeColorShape:B,changeShape:A,onClear:P,onRedo:v,onThicknessChange:q,onUndo:p,refEditor:r,setColorHighlight:M,setColorPen:b,setThicknessPen:S})]}),t.jsx(w.DialogFooter,{children:t.jsx(R.Button,{onClick:g,type:"button",children:"Save changes"})})]})]})}const ge={maxWidth:"auto",zIndex:20,appendTo:"parent",moveTransition:"transform 0.1s ease-out"};function pe({item:e,disabled:n,editor:s}){var i;const a=e.component;return a?t.jsx(o.Fragment,{children:e.type==="divider"?t.jsx(J.Separator,{className:"!richtext-mx-1 !richtext-my-2 !richtext-h-[16px]",orientation:"vertical"}):t.jsx(a,{...e.componentProps,disabled:n||((i=e==null?void 0:e.componentProps)==null?void 0:i.disabled),editor:s})}):t.jsx(t.Fragment,{})}function we(e){return e.type.name==="drawer"}function je(e){const{lang:n}=D.useLocale(),s=N.useAttributes(e.editor,L.Drawer.name),a=Q(e.editor,L.Drawer.name),i=({editor:c})=>{const{selection:d}=c.view.state,{$from:h,to:m}=d;let f=!1;return c.view.state.doc.nodesBetween(h.pos,m,g=>{if(we(g))return f=!0,!1}),f},r=o.useMemo(()=>e.disabled?[]:$.getBubbleDrawer(e.editor),[e.disabled,e.editor,n]);return t.jsx(t.Fragment,{children:t.jsx(T.BubbleMenu,{editor:e==null?void 0:e.editor,shouldShow:i,tippyOptions:ge,children:r!=null&&r.length?t.jsx("div",{className:"richtext-pointer-events-auto richtext-w-auto richtext-select-none richtext-rounded-sm !richtext-border richtext-border-neutral-200 richtext-bg-background richtext-px-3 richtext-py-2 richtext-shadow-sm richtext-transition-all dark:richtext-border-neutral-800",children:t.jsx("div",{className:"richtext-relative richtext-flex richtext-h-[26px] richtext-flex-nowrap richtext-items-center richtext-justify-start richtext-whitespace-nowrap",children:r==null?void 0:r.map((c,d)=>c.type==="edit"&&(s!=null&&s.src)?t.jsx(be,{attrs:s,editor:e.editor,extension:a},`bubbleMenu-drawer-${d}`):t.jsx(pe,{disabled:e.disabled,editor:e.editor,item:c},`bubbleMenu-drawer-${d}`))})}):t.jsx(t.Fragment,{})})})}exports.BubbleMenuDrawer=je;exports.BubbleMenuExcalidraw=xe;exports.BubbleMenuKatex=fe;exports.BubbleMenuMermaid=ue;exports.BubbleMenuTwitter=me;
