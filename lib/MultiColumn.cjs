"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const s=require("./index-CSvnpArE.cjs"),x=require("./ActionButton-DY0olRIe.cjs");function A(e,t,r=null){return r?e.createChecked({index:t},r):e.createAndFill({index:t})}function N(e){if(e.cached.columnsNodeTypes)return e.cached.columnsNodeTypes;const t={columns:e.nodes.columns,column:e.nodes.column};return e.cached.columnsNodeTypes=t,t}function g(e,t,r=null){const o=N(e),l=[];for(let n=0;n<t;n+=1){const c=A(o.column,n,r);c&&l.push(c)}return o.columns.createChecked({cols:t},l)}function f({state:e,dispatch:t,type:r}){const o=s.findParentNode(n=>n.type.name===h.name)(e.selection),l=s.findParentNode(n=>n.type.name===T.name)(e.selection);if(t&&o&&l){const n=o.node,c=l.node.attrs.index,i=n.toJSON();let u=c;r==="delete"?(u=c-1,i.content.splice(c,1)):(u=r==="addBefore"?c:c+1,i.content.splice(u,0,{type:"column",attrs:{index:c},content:[{type:"paragraph"}]})),i.attrs.cols=i.content.length,i.content.forEach((a,C)=>{a.attrs.index=C});const d=s.Node$1.fromJSON(e.schema,i);let m=o.pos;d.content.forEach((a,C,y)=>{y<u&&(m+=a.nodeSize)});const p=e.tr.setTime(Date.now());p.replaceWith(o.pos,o.pos+o.node.nodeSize,d).setSelection(s.TextSelection.near(p.doc.resolve(m))),t(p)}return!0}function b({state:e,dispatch:t,type:r}){const o=s.findParentNode(n=>n.type.name===h.name)(e.selection),l=s.findParentNode(n=>n.type.name===T.name)(e.selection);if(t&&o&&l){const n=o.node,c=l.node.attrs.index;let i=0;r==="before"?i=(c-1+n.attrs.cols)%n.attrs.cols:i=(c+1)%n.attrs.cols;let u=o.pos;n.content.forEach((m,p,a)=>{a<i&&(u+=m.nodeSize)});const d=e.tr.setTime(Date.now());return d.setSelection(s.TextSelection.near(d.doc.resolve(u))),t(d),!0}return!1}const T=s.Node.create({name:"column",content:"block+",isolating:!0,addOptions(){return{HTMLAttributes:{class:"column"}}},addAttributes(){return{index:{default:0,parseHTML:e=>e.getAttribute("index")}}},parseHTML(){return[{tag:"div[class=column]"}]},renderHTML({HTMLAttributes:e}){return["div",s.mergeAttributes(this.options.HTMLAttributes,e),0]}}),H=s.Extension.create({name:"columnActionButton",addOptions(){var e;return{...(e=this.parent)==null?void 0:e.call(this),button:({editor:t,t:r})=>({component:x.ActionButton,componentProps:{action:()=>{t.chain().focus().insertColumns({cols:2}).run()},icon:"Columns",tooltip:r("editor.columns.tooltip")}})}}}),S=200,h=s.Node.create({name:"columns",group:"block",defining:!0,isolating:!0,allowGapCursor:!1,content:"column{1,}",priority:S,addOptions(){return{HTMLAttributes:{class:"columns"}}},addAttributes(){return{cols:{default:2,parseHTML:e=>e.getAttribute("cols")}}},parseHTML(){return[{tag:"div[class=grid]"}]},renderHTML({HTMLAttributes:e}){return["div",s.mergeAttributes(this.options.HTMLAttributes,e),0]},addCommands(){return{insertColumns:e=>({tr:t,dispatch:r,editor:o})=>{const l=g(o.schema,e&&e.cols||3);if(r){const n=t.selection.anchor+1;t.replaceSelectionWith(l).scrollIntoView().setSelection(s.TextSelection.near(t.doc.resolve(n)))}return!0},addColBefore:()=>({dispatch:e,state:t})=>f({dispatch:e,state:t,type:"addBefore"}),addColAfter:()=>({dispatch:e,state:t})=>f({dispatch:e,state:t,type:"addAfter"}),deleteCol:()=>({dispatch:e,state:t})=>f({dispatch:e,state:t,type:"delete"})}},addKeyboardShortcuts(){return{"Mod-Alt-G":()=>this.editor.commands.insertColumns(),Tab:()=>b({state:this.editor.state,dispatch:this.editor.view.dispatch,type:"after"}),"Shift-Tab":()=>b({state:this.editor.state,dispatch:this.editor.view.dispatch,type:"before"})}}});exports.Column=T;exports.ColumnActionButton=H;exports.EXTENSION_PRIORITY_HIGHEST=S;exports.MultiColumn=h;
