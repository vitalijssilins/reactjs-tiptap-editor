"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const o=require("./index-CSvnpArE.cjs"),f=require("./index-ugE1dRs4.cjs"),n=require("react/jsx-runtime"),u=require("react"),b=require("katex"),w=require("lucide-react"),$=require("./ActionButton-DY0olRIe.cjs"),k=require("./textarea-BYF4nPuF.cjs"),p=require("./theme-DvNbe4l0.cjs"),v=require("./index-BObJ0_Vs.cjs"),l=require("./popover-C53Gavq8.cjs"),T=require("./label-Dy0JqoBR.cjs"),N=require("./button-BT4Gvjni.cjs");function q({editor:e,...t}){const{t:s}=v.useLocale(),c=p.useAttributes(e,x.name,{text:"",defaultShowPicker:!1}),{text:a,defaultShowPicker:r}=c,[i,d]=u.useState(""),g=u.useCallback(()=>{e.chain().focus().setKatex({text:i}).run(),d("")},[e,i]);u.useEffect(()=>{r&&e.chain().updateAttributes(x.name,{defaultShowPicker:!1}).focus().run()},[e,r]);const h=u.useMemo(()=>{try{return b.renderToString(`${i}`)}catch{return i}},[i]),m=u.useMemo(()=>`${i}`.trim()?n.jsx("span",{contentEditable:!1,dangerouslySetInnerHTML:{__html:h||""}}):null,[i,h]);return n.jsxs(l.Popover,{modal:!0,children:[n.jsx(l.PopoverTrigger,{asChild:!0,children:n.jsx($.ActionButton,{icon:t==null?void 0:t.icon,tooltip:t==null?void 0:t.tooltip})}),n.jsxs(l.PopoverContent,{align:"start",className:"richtext-size-full richtext-p-2",hideWhenDetached:!0,side:"bottom",children:[n.jsx(T.Label,{className:"richtext-mb-[6px]",children:s("editor.formula.dialog.text")}),n.jsx("div",{className:"richtext-mb-[16px] richtext-flex richtext-w-full richtext-max-w-sm richtext-items-center richtext-gap-1.5",children:n.jsx("div",{className:"richtext-relative richtext-w-full richtext-max-w-sm",children:n.jsx(k.Textarea,{autoFocus:!0,className:"richtext-w-full",defaultValue:a,onChange:j=>d(j.target.value),placeholder:"Text",required:!0,rows:3,value:i})})}),m&&n.jsx("div",{className:"richtext-my-[10px] richtext-max-w-[286px] richtext-overflow-auto richtext-whitespace-nowrap richtext-rounded-[6px] !richtext-border richtext-p-[10px]",children:m}),n.jsxs("div",{className:"richtext-flex richtext-items-center richtext-justify-between richtext-gap-[6px]",children:[n.jsx(N.Button,{className:"richtext-flex-1",onClick:g,children:"Submit"}),n.jsx("a",{href:"https://katex.org/docs/supported",rel:"noreferrer noopener",target:"_blank",children:n.jsx(w.HelpCircle,{size:16})})]})]})]})}function A(e,t=1){let s=0,c=0,a=0;if(e.startsWith("rgb")){const r=e.replace(/\s/g,"").match(/rgb\((.*)\)$/)[1].split(",");s=+r[0],c=+r[1],a=+r[2]}else if(e.startsWith("#")){let r=e.replace("#","");r.length===3&&(r=`${r[0]}${r[0]}${r[1]}${r[1]}${r[2]}${r[2]}`),s=Number.parseInt(r.substring(0,2),16),c=Number.parseInt(r.substring(2,4),16),a=Number.parseInt(r.substring(4,6),16)}else return e;return t>1&&t<=100&&(t=t/100),`rgba(${s},${c},${a},${t})`}function M({node:e}){const t=p.useTheme(),{text:s}=e.attrs,c=u.useMemo(()=>{const i="rgb(254, 242, 237)";return t==="dark"?A(i,.75):i},[t]),a=u.useMemo(()=>{try{return b.renderToString(`${s}`)}catch{return s}},[s]),r=u.useMemo(()=>s.trim()?n.jsx("span",{contentEditable:!1,dangerouslySetInnerHTML:{__html:a}}):n.jsx("span",{contentEditable:!1,children:"Not enter a formula"}),[s,a]);return n.jsx(f.NodeViewWrapper,{style:{display:"inline-block",backgroundColor:c},as:"span",children:r})}function S(e){return t=>t.getAttribute(e)}const x=o.Node.create({name:"katex",group:"inline",inline:!0,defining:!0,draggable:!0,selectable:!0,addOptions(){return{HTMLAttributes:{class:"katex"},button:({editor:e,t})=>({component:q,componentProps:{editor:e,action:()=>!0,isActive:()=>!1,disabled:!1,icon:"KatexIcon",tooltip:t("editor.katex.tooltip")}})}},addAttributes(){return{text:{default:"",parseHTML:S("text")},defaultShowPicker:{default:!1}}},parseHTML(){return[{tag:"span.katex"}]},renderHTML({HTMLAttributes:e}){return["span",o.mergeAttributes(this.options&&this.options.HTMLAttributes||{},e)]},addCommands(){return{setKatex:e=>({commands:t})=>t.insertContent({type:this.name,attrs:e})}},addInputRules(){return[o.nodeInputRule({find:/^\$katex\$$/,type:this.type,getAttributes:()=>({defaultShowPicker:!0})})]},addNodeView(){return f.ReactNodeViewRenderer(M)}});exports.Katex=x;
