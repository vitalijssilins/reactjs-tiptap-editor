"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const L=require("./index-CSvnpArE.cjs"),D=require("./index-CWKNKm3Y.cjs"),o=require("react/jsx-runtime"),h=require("react"),k=require("./ActionButton-DY0olRIe.cjs"),m=require("./dialog-CVd5Mqbw.cjs"),A=require("./utils-DmD36e1i.cjs"),S=require("./index-BObJ0_Vs.cjs"),y=require("./events.constant-Cyyj4OFH.cjs"),f=require("./tabs-ljg6aJ1o.cjs"),j=require("./button-BT4Gvjni.cjs"),q=require("./input-8Tv6i4jL.cjs");function C(e,t){let r;try{r=new URL(e)}catch{return!1}return!(t!=null&&t.length)||t.length===1&&t[0]==="."?!0:t.some(s=>{if(s.includes("*")){const a=s.replace(/\./g,"\\.").replace(/\*/g,".*");return new RegExp(`^${a}$`).test(r.hostname)}return r.hostname.includes(s)})}function $(e){const{t}=S.useLocale(),[r,s]=h.useState(""),a=h.useRef(null),[c,p]=h.useState(""),[b,d]=h.useState(!1),x=n=>{d(n.detail)};h.useEffect(()=>{const n=y.listenEvent(y.EVENTS.UPLOAD_VIDEO(e.editor.id),x);return()=>{n()}},[]);const i=h.useMemo(()=>{var l;return(l=e.editor.extensionManager.extensions.find(u=>u.name===V.name))==null?void 0:l.options},[e.editor]);async function g(n){var w;const l=(w=n==null?void 0:n.target)==null?void 0:w.files;if(!e.editor||e.editor.isDestroyed||l.length===0)return;const u=l[0];let v="";i.upload?v=await i.upload(u):v=URL.createObjectURL(u),e.editor.chain().focus().setVideo({src:v,width:"100%"}).run(),d(!1)}function M(n){n.preventDefault(),n.stopPropagation(),r&&(e.editor.chain().focus().setVideo({src:r,width:"100%"}).run(),d(!1))}function T(n){var l;n.preventDefault(),(l=a.current)==null||l.click()}return o.jsxs(m.Dialog,{onOpenChange:d,open:b,children:[o.jsx(m.DialogTrigger,{asChild:!0,children:o.jsx(k.ActionButton,{action:()=>d(!0),icon:e.icon,tooltip:e.tooltip})}),o.jsxs(m.DialogContent,{children:[o.jsx(m.DialogTitle,{children:t("editor.video.dialog.title")}),o.jsxs(f.Tabs,{activationMode:"manual",defaultValue:(i==null?void 0:i.resourceVideo)==="both"||(i==null?void 0:i.resourceVideo)==="upload"?"upload":"link",children:[o.jsxs(f.TabsList,{className:"richtext-grid richtext-w-full richtext-grid-cols-2",children:[((i==null?void 0:i.resourceVideo)==="both"||(i==null?void 0:i.resourceVideo)==="upload")&&o.jsx(f.TabsTrigger,{value:"upload",children:t("editor.video.dialog.tab.upload")}),((i==null?void 0:i.resourceVideo)==="both"||(i==null?void 0:i.resourceVideo)==="link")&&o.jsx(f.TabsTrigger,{value:"link",children:t("editor.video.dialog.link")})]}),o.jsxs(f.TabsContent,{value:"upload",children:[o.jsx("div",{className:"richtext-flex richtext-items-center richtext-gap-[10px]",children:o.jsx(j.Button,{className:"richtext-mt-1 richtext-w-full",onClick:T,size:"sm",children:t("editor.video.dialog.tab.upload")})}),o.jsx("input",{accept:"video/*",multiple:!0,onChange:g,ref:a,type:"file",style:{display:"none"}})]}),o.jsxs(f.TabsContent,{value:"link",children:[o.jsx("form",{onSubmit:M,children:o.jsxs("div",{className:"richtext-flex richtext-items-center richtext-gap-2",children:[o.jsx(q.Input,{autoFocus:!0,placeholder:t("editor.video.dialog.placeholder"),required:!0,type:"url",value:r,onChange:n=>{s(n.target.value)},onBlur:n=>{const l=n.target.value,u=i.videoProviders||["."];l&&!C(l,u)?p("Invalid video URL"):p("")}}),o.jsx(j.Button,{type:"submit",children:t("editor.video.dialog.button.apply")})]})}),c&&o.jsx("div",{className:"richtext-my-[5px] richtext-text-red-500",children:c})]})]})]})]})}function I(e){e=e.replace("https://youtu.be/","https://www.youtube.com/watch?v=").replace("watch?v=","embed/");const t=e.match(/^https:\/\/www\.youtube\.com\/shorts\/([a-zA-Z0-9_-]+)/);t&&(e=`https://www.youtube.com/embed/${t[1]}`);const r=e.match(/^https:\/\/vimeo\.com\/(\d+)(?:\/([a-zA-Z0-9]+))?/);if(r){const a=r[1],c=r[2];c?e=`https://player.vimeo.com/video/${a}?h=${c}`:e=`https://player.vimeo.com/video/${a}`}return/^https?:\/\/www.bilibili.com\/video\/.*/i.test(e)&&(e=e.replace(/\?.*$/,"").replace("https://www.bilibili.com/video/","https://player.bilibili.com/player.html?bvid=")),e.includes("drive.google.com")&&(e=e.replace("/view","/preview")),e}const V=L.Node.create({name:"video",group:"block",atom:!0,draggable:!0,addOptions(){return{divider:!1,spacer:!1,allowFullscreen:!0,upload:void 0,frameborder:!1,resourceVideo:"both",width:D.VIDEO_SIZE["size-medium"],HTMLAttributes:{class:"iframe-wrapper"},button:({editor:e,t})=>{var r,s;return{component:$,componentProps:{action:()=>{},isActive:()=>e.isActive("video")||!1,disabled:!((s=(r=e.can()).setVideo)!=null&&s.call(r,{})),icon:"Video",tooltip:t("editor.video.tooltip"),videoProviders:["."],editor:e}}}}},addAttributes(){return{src:{default:null,renderHTML:({src:e})=>({src:e?I(e):null})},width:{default:this.options.width,renderHTML:({width:e})=>({width:A.getCssUnitWithDefault(e)})},frameborder:{default:this.options.frameborder?1:0,parseHTML:()=>this.options.frameborder?1:0},allowfullscreen:{default:this.options.allowFullscreen,parseHTML:()=>this.options.allowFullscreen},align:{default:"center",renderHTML:({align:e})=>({align:e})}}},parseHTML(){return[{tag:"div[data-video] iframe"}]},renderHTML({HTMLAttributes:e}){const{width:t="100%",align:r="center"}=e??{},s={...e,width:"100%",height:"100%"},a=`position: relative;overflow: hidden;display: flex;flex: 1;max-width: ${t};`,c=`flex: 1;padding-bottom: ${9/16*100}%;`,i=["div",{style:`display: flex; justify-content: ${r};`},["div",{style:a},["div",{style:c}],["iframe",s]]];return["div",{...this.options.HTMLAttributes,class:"iframe-wrapper","data-video":""},i]},addCommands(){return{setVideo:e=>({commands:t})=>t.insertContent({type:this.name,attrs:e}),updateVideo:e=>({commands:t})=>t.updateAttributes(this.name,e)}}});exports.Video=V;
