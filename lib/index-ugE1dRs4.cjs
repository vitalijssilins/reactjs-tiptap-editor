"use strict";const R=require("./index-CSvnpArE.cjs"),re=require("tippy.js"),a=require("react"),X=require("react-dom");class ie{constructor({editor:e,element:t,view:r,tippyOptions:i={},updateDelay:o=250,shouldShow:p}){this.preventHide=!1,this.shouldShow=({view:s,state:h,from:f,to:c})=>{const{doc:d,selection:v}=h,{empty:m}=v,y=!d.textBetween(f,c).length&&R.isTextSelection(h.selection),E=this.element.contains(document.activeElement);return!(!(s.hasFocus()||E)||m||y||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:s})=>{var h;if(this.preventHide){this.preventHide=!1;return}s!=null&&s.relatedTarget&&(!((h=this.element.parentNode)===null||h===void 0)&&h.contains(s.relatedTarget))||(s==null?void 0:s.relatedTarget)!==this.editor.view.dom&&this.hide()},this.tippyBlurHandler=s=>{this.blurHandler({event:s})},this.handleDebouncedUpdate=(s,h)=>{const f=!(h!=null&&h.selection.eq(s.state.selection)),c=!(h!=null&&h.doc.eq(s.state.doc));!f&&!c||(this.updateDebounceTimer&&clearTimeout(this.updateDebounceTimer),this.updateDebounceTimer=window.setTimeout(()=>{this.updateHandler(s,f,c,h)},this.updateDelay))},this.updateHandler=(s,h,f,c)=>{var d,v,m;const{state:y,composing:E}=s,{selection:_}=y;if(E||!h&&!f)return;this.createTooltip();const{ranges:D}=_,S=Math.min(...D.map(u=>u.$from.pos)),l=Math.max(...D.map(u=>u.$to.pos));if(!((d=this.shouldShow)===null||d===void 0?void 0:d.call(this,{editor:this.editor,element:this.element,view:s,state:y,oldState:c,from:S,to:l}))){this.hide();return}(v=this.tippy)===null||v===void 0||v.setProps({getReferenceClientRect:((m=this.tippyOptions)===null||m===void 0?void 0:m.getReferenceClientRect)||(()=>{if(R.isNodeSelection(y.selection)){let u=s.nodeDOM(S);if(u){const b=u.dataset.nodeViewWrapper?u:u.querySelector("[data-node-view-wrapper]");if(b&&(u=b.firstChild),u)return u.getBoundingClientRect()}}return R.posToDOMRect(s,S,l)})}),this.show()},this.editor=e,this.element=t,this.view=r,this.updateDelay=o,p&&(this.shouldShow=p),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=i,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,t=!!e.parentElement;this.tippy||!t||(this.tippy=re(e,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(e,t){const{state:r}=e,i=r.selection.from!==r.selection.to;if(this.updateDelay>0&&i){this.handleDebouncedUpdate(e,t);return}const o=!(t!=null&&t.selection.eq(e.state.selection)),p=!(t!=null&&t.doc.eq(e.state.doc));this.updateHandler(e,o,p,t)}show(){var e;(e=this.tippy)===null||e===void 0||e.show()}hide(){var e;(e=this.tippy)===null||e===void 0||e.hide()}destroy(){var e,t;!((e=this.tippy)===null||e===void 0)&&e.popper.firstChild&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),(t=this.tippy)===null||t===void 0||t.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const Z=n=>new R.Plugin({key:typeof n.pluginKey=="string"?new R.PluginKey(n.pluginKey):n.pluginKey,view:e=>new ie({view:e,...n})});R.Extension.create({name:"bubbleMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"bubbleMenu",updateDelay:void 0,shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[Z({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,updateDelay:this.options.updateDelay,shouldShow:this.options.shouldShow})]:[]}});function oe(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var j={exports:{}},H={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W;function se(){if(W)return H;W=1;var n=a;function e(d,v){return d===v&&(d!==0||1/d===1/v)||d!==d&&v!==v}var t=typeof Object.is=="function"?Object.is:e,r=n.useState,i=n.useEffect,o=n.useLayoutEffect,p=n.useDebugValue;function s(d,v){var m=v(),y=r({inst:{value:m,getSnapshot:v}}),E=y[0].inst,_=y[1];return o(function(){E.value=m,E.getSnapshot=v,h(E)&&_({inst:E})},[d,m,v]),i(function(){return h(E)&&_({inst:E}),d(function(){h(E)&&_({inst:E})})},[d]),p(m),m}function h(d){var v=d.getSnapshot;d=d.value;try{var m=v();return!t(d,m)}catch{return!0}}function f(d,v){return v()}var c=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?f:s;return H.useSyncExternalStore=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:c,H}var B={};/**
 * @license React
 * use-sync-external-store-shim.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var q;function ue(){return q||(q=1,process.env.NODE_ENV!=="production"&&function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var n=a,e=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function t(S){{for(var l=arguments.length,O=new Array(l>1?l-1:0),u=1;u<l;u++)O[u-1]=arguments[u];r("error",S,O)}}function r(S,l,O){{var u=e.ReactDebugCurrentFrame,b=u.getStackAddendum();b!==""&&(l+="%s",O=O.concat([b]));var w=O.map(function(g){return String(g)});w.unshift("Warning: "+l),Function.prototype.apply.call(console[S],console,w)}}function i(S,l){return S===l&&(S!==0||1/S===1/l)||S!==S&&l!==l}var o=typeof Object.is=="function"?Object.is:i,p=n.useState,s=n.useEffect,h=n.useLayoutEffect,f=n.useDebugValue,c=!1,d=!1;function v(S,l,O){c||n.startTransition!==void 0&&(c=!0,t("You are using an outdated, pre-release alpha of React 18 that does not support useSyncExternalStore. The use-sync-external-store shim will not work correctly. Upgrade to a newer pre-release."));var u=l();if(!d){var b=l();o(u,b)||(t("The result of getSnapshot should be cached to avoid an infinite loop"),d=!0)}var w=p({inst:{value:u,getSnapshot:l}}),g=w[0].inst,T=w[1];return h(function(){g.value=u,g.getSnapshot=l,m(g)&&T({inst:g})},[S,u,l]),s(function(){m(g)&&T({inst:g});var V=function(){m(g)&&T({inst:g})};return S(V)},[S]),f(u),u}function m(S){var l=S.getSnapshot,O=S.value;try{var u=l();return!o(O,u)}catch{return!0}}function y(S,l,O){return l()}var E=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",_=!E,C=_?y:v,D=n.useSyncExternalStore!==void 0?n.useSyncExternalStore:C;B.useSyncExternalStore=D,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)}()),B}process.env.NODE_ENV==="production"?j.exports=se():j.exports=ue();var L=j.exports;const ae=(...n)=>e=>{n.forEach(t=>{typeof t=="function"?t(e):t&&(t.current=e)})},de=({contentComponent:n})=>{const e=L.useSyncExternalStore(n.subscribe,n.getSnapshot,n.getServerSnapshot);return a.createElement(a.Fragment,null,Object.values(e))};function ce(){const n=new Set;let e={};return{subscribe(t){return n.add(t),()=>{n.delete(t)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(t,r){e={...e,[t]:X.createPortal(r.reactElement,r.element,t)},n.forEach(i=>i())},removeRenderer(t){const r={...e};delete r[t],e=r,n.forEach(i=>i())}}}class le extends a.Component{constructor(e){var t;super(e),this.editorContentRef=a.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!(!((t=e.editor)===null||t===void 0)&&t.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const e=this.props.editor;if(e&&!e.isDestroyed&&e.options.element){if(e.contentComponent)return;const t=this.editorContentRef.current;t.append(...e.options.element.childNodes),e.setOptions({element:t}),e.contentComponent=ce(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(r=>r.hasContentComponentInitialized?r:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){const e=this.props.editor;if(!e||(this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null,!e.options.element.firstChild))return;const t=document.createElement("div");t.append(...e.options.element.childNodes),e.setOptions({element:t})}render(){const{editor:e,innerRef:t,...r}=this.props;return a.createElement(a.Fragment,null,a.createElement("div",{ref:ae(t,this.editorContentRef),...r}),(e==null?void 0:e.contentComponent)&&a.createElement(de,{contentComponent:e.contentComponent}))}}const he=a.forwardRef((n,e)=>{const t=a.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[n.editor]);return a.createElement(le,{key:t,innerRef:e,...n})}),fe=a.memo(he);var pe=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,i,o;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(i=r;i--!==0;)if(!n(e[i],t[i]))return!1;return!0}if(e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(i of e.entries())if(!t.has(i[0]))return!1;for(i of e.entries())if(!n(i[1],t.get(i[0])))return!1;return!0}if(e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(i of e.entries())if(!t.has(i[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(r=e.length,r!=t.length)return!1;for(i=r;i--!==0;)if(e[i]!==t[i])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(o=Object.keys(e),r=o.length,r!==Object.keys(t).length)return!1;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(t,o[i]))return!1;for(i=r;i--!==0;){var p=o[i];if(!(p==="_owner"&&e.$$typeof)&&!n(e[p],t[p]))return!1}return!0}return e!==e&&t!==t},ve=oe(pe),F={exports:{}},P={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z;function me(){if(z)return P;z=1;var n=a,e=L;function t(f,c){return f===c&&(f!==0||1/f===1/c)||f!==f&&c!==c}var r=typeof Object.is=="function"?Object.is:t,i=e.useSyncExternalStore,o=n.useRef,p=n.useEffect,s=n.useMemo,h=n.useDebugValue;return P.useSyncExternalStoreWithSelector=function(f,c,d,v,m){var y=o(null);if(y.current===null){var E={hasValue:!1,value:null};y.current=E}else E=y.current;y=s(function(){function C(u){if(!D){if(D=!0,S=u,u=v(u),m!==void 0&&E.hasValue){var b=E.value;if(m(b,u))return l=b}return l=u}if(b=l,r(S,u))return b;var w=v(u);return m!==void 0&&m(b,w)?b:(S=u,l=w)}var D=!1,S,l,O=d===void 0?null:d;return[function(){return C(c())},O===null?void 0:function(){return C(O())}]},[c,d,v,m]);var _=i(f,y[0],y[1]);return p(function(){E.hasValue=!0,E.value=_},[_]),h(_),_},P}var U={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G;function Se(){return G||(G=1,process.env.NODE_ENV!=="production"&&function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var n=a,e=L;function t(c,d){return c===d&&(c!==0||1/c===1/d)||c!==c&&d!==d}var r=typeof Object.is=="function"?Object.is:t,i=e.useSyncExternalStore,o=n.useRef,p=n.useEffect,s=n.useMemo,h=n.useDebugValue;function f(c,d,v,m,y){var E=o(null),_;E.current===null?(_={hasValue:!1,value:null},E.current=_):_=E.current;var C=s(function(){var O=!1,u,b,w=function(M){if(!O){O=!0,u=M;var x=m(M);if(y!==void 0&&_.hasValue){var N=_.value;if(y(N,x))return b=N,N}return b=x,x}var ne=u,A=b;if(r(ne,M))return A;var I=m(M);return y!==void 0&&y(A,I)?A:(u=M,b=I,I)},g=v===void 0?null:v,T=function(){return w(d())},V=g===null?void 0:function(){return w(g())};return[T,V]},[d,v,m,y]),D=C[0],S=C[1],l=i(c,D,S);return p(function(){_.hasValue=!0,_.value=l},[l]),h(l),l}U.useSyncExternalStoreWithSelector=f,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)}()),U}process.env.NODE_ENV==="production"?F.exports=me():F.exports=Se();var Ee=F.exports;const ye=typeof window<"u"?a.useLayoutEffect:a.useEffect;class _e{constructor(e){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=e,this.lastSnapshot={editor:e,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}}watch(e){if(this.editor=e,this.editor){const t=()=>{this.transactionNumber+=1,this.subscribers.forEach(i=>i())},r=this.editor;return r.on("transaction",t),()=>{r.off("transaction",t)}}}}function be(n){var e;const[t]=a.useState(()=>new _e(n.editor)),r=Ee.useSyncExternalStoreWithSelector(t.subscribe,t.getSnapshot,t.getServerSnapshot,n.selector,(e=n.equalityFn)!==null&&e!==void 0?e:ve);return ye(()=>t.watch(n.editor),[n.editor,t]),a.useDebugValue(r),r}const Y=process.env.NODE_ENV!=="production",$=typeof window>"u",Oe=$||!!(typeof window<"u"&&window.next);class K{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(t=>t())}getInitialEditor(){if(this.options.current.immediatelyRender===void 0)return $||Oe?(Y&&console.warn("Tiptap Error: SSR has been detected, please set `immediatelyRender` explicitly to `false` to avoid hydration mismatches."),null):this.createEditor();if(this.options.current.immediatelyRender&&$&&Y)throw new Error("Tiptap Error: SSR has been detected, and `immediatelyRender` has been set to `true` this is an unsupported configuration that may result in errors, explicitly set `immediatelyRender` to `false` to avoid hydration mismatches.");return this.options.current.immediatelyRender?this.createEditor():null}createEditor(){const e={...this.options.current,onBeforeCreate:(...r)=>{var i,o;return(o=(i=this.options.current).onBeforeCreate)===null||o===void 0?void 0:o.call(i,...r)},onBlur:(...r)=>{var i,o;return(o=(i=this.options.current).onBlur)===null||o===void 0?void 0:o.call(i,...r)},onCreate:(...r)=>{var i,o;return(o=(i=this.options.current).onCreate)===null||o===void 0?void 0:o.call(i,...r)},onDestroy:(...r)=>{var i,o;return(o=(i=this.options.current).onDestroy)===null||o===void 0?void 0:o.call(i,...r)},onFocus:(...r)=>{var i,o;return(o=(i=this.options.current).onFocus)===null||o===void 0?void 0:o.call(i,...r)},onSelectionUpdate:(...r)=>{var i,o;return(o=(i=this.options.current).onSelectionUpdate)===null||o===void 0?void 0:o.call(i,...r)},onTransaction:(...r)=>{var i,o;return(o=(i=this.options.current).onTransaction)===null||o===void 0?void 0:o.call(i,...r)},onUpdate:(...r)=>{var i,o;return(o=(i=this.options.current).onUpdate)===null||o===void 0?void 0:o.call(i,...r)},onContentError:(...r)=>{var i,o;return(o=(i=this.options.current).onContentError)===null||o===void 0?void 0:o.call(i,...r)},onDrop:(...r)=>{var i,o;return(o=(i=this.options.current).onDrop)===null||o===void 0?void 0:o.call(i,...r)},onPaste:(...r)=>{var i,o;return(o=(i=this.options.current).onPaste)===null||o===void 0?void 0:o.call(i,...r)}};return new R.Editor(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,t){return Object.keys(e).every(r=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(r)?!0:r==="extensions"&&e.extensions&&t.extensions?e.extensions.length!==t.extensions.length?!1:e.extensions.every((i,o)=>{var p;return i===((p=t.extensions)===null||p===void 0?void 0:p[o])}):e[r]===t[r])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?K.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((r,i)=>r===e[i]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,t=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){t&&t.setOptions(this.options.current);return}t&&!t.isDestroyed&&(t.destroy(),this.instanceId===e&&this.setEditor(null))},1)}}function ge(n={},e=[]){const t=a.useRef(n);t.current=n;const[r]=a.useState(()=>new K(t)),i=L.useSyncExternalStore(r.subscribe,r.getEditor,r.getServerSnapshot);return a.useDebugValue(i),a.useEffect(r.onRender(e)),be({editor:i,selector:({transactionNumber:o})=>n.shouldRerenderOnTransaction===!1?null:n.immediatelyRender&&o===0?0:o+1}),i}const k=a.createContext({editor:null});k.Consumer;const we=()=>a.useContext(k),De=n=>{const[e,t]=a.useState(null),{editor:r}=we();return a.useEffect(()=>{var i;if(!e||!((i=n.editor)===null||i===void 0)&&i.isDestroyed||r!=null&&r.isDestroyed)return;const{pluginKey:o="bubbleMenu",editor:p,tippyOptions:s={},updateDelay:h,shouldShow:f=null}=n,c=p||r;if(!c){console.warn("BubbleMenu component is not rendered inside of an editor component or does not have editor prop.");return}const d=Z({updateDelay:h,editor:c,element:e,pluginKey:o,shouldShow:f,tippyOptions:s});return c.registerPlugin(d),()=>{c.unregisterPlugin(o)}},[n.editor,r,e]),a.createElement("div",{ref:t,className:n.className,style:{visibility:"hidden"}},n.children)},ee=a.createContext({onDragStart:void 0}),Re=()=>a.useContext(ee),Ce=a.forwardRef((n,e)=>{const{onDragStart:t}=Re(),r=n.as||"div";return a.createElement(r,{...n,ref:e,"data-node-view-wrapper":"",onDragStart:t,style:{whiteSpace:"normal",...n.style}})});function J(n){return!!(typeof n=="function"&&n.prototype&&n.prototype.isReactComponent)}function Q(n){return!!(typeof n=="object"&&n.$$typeof&&(n.$$typeof.toString()==="Symbol(react.forward_ref)"||n.$$typeof.description==="react.forward_ref"))}function Te(n){return!!(typeof n=="object"&&n.$$typeof&&(n.$$typeof.toString()==="Symbol(react.memo)"||n.$$typeof.description==="react.memo"))}function Me(n){if(J(n)||Q(n))return!0;if(Te(n)){const e=n.type;if(e)return J(e)||Q(e)}return!1}function Le(){try{if(a.version)return parseInt(a.version.split(".")[0],10)>=19}catch{}return!1}class te{constructor(e,{editor:t,props:r={},as:i="div",className:o=""}){this.ref=null,this.id=Math.floor(Math.random()*4294967295).toString(),this.component=e,this.editor=t,this.props=r,this.element=document.createElement(i),this.element.classList.add("react-renderer"),o&&this.element.classList.add(...o.split(" ")),this.editor.isInitialized?X.flushSync(()=>{this.render()}):this.render()}render(){var e;const t=this.component,r=this.props,i=this.editor,o=Le(),p=Me(t),s={...r};s.ref&&!(o||p)&&delete s.ref,!s.ref&&(o||p)&&(s.ref=h=>{this.ref=h}),this.reactElement=a.createElement(t,{...s}),(e=i==null?void 0:i.contentComponent)===null||e===void 0||e.setRenderer(this.id,this)}updateProps(e={}){this.props={...this.props,...e},this.render()}destroy(){var e;const t=this.editor;(e=t==null?void 0:t.contentComponent)===null||e===void 0||e.removeRenderer(this.id)}updateAttributes(e){Object.keys(e).forEach(t=>{this.element.setAttribute(t,e[t])})}}class Ve extends R.NodeView{mount(){const e={editor:this.editor,node:this.node,decorations:this.decorations,innerDecorations:this.innerDecorations,view:this.view,selected:!1,extension:this.extension,HTMLAttributes:this.HTMLAttributes,getPos:()=>this.getPos(),updateAttributes:(f={})=>this.updateAttributes(f),deleteNode:()=>this.deleteNode(),ref:a.createRef()};if(!this.component.displayName){const f=c=>c.charAt(0).toUpperCase()+c.substring(1);this.component.displayName=f(this.extension.name)}const i={onDragStart:this.onDragStart.bind(this),nodeViewContentRef:f=>{f&&this.contentDOMElement&&f.firstChild!==this.contentDOMElement&&f.appendChild(this.contentDOMElement)}},o=this.component,p=a.memo(f=>a.createElement(ee.Provider,{value:i},a.createElement(o,f)));p.displayName="ReactNodeView",this.node.isLeaf?this.contentDOMElement=null:this.options.contentDOMElementTag?this.contentDOMElement=document.createElement(this.options.contentDOMElementTag):this.contentDOMElement=document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement&&(this.contentDOMElement.dataset.nodeViewContentReact="",this.contentDOMElement.style.whiteSpace="inherit");let s=this.node.isInline?"span":"div";this.options.as&&(s=this.options.as);const{className:h=""}=this.options;this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.renderer=new te(p,{editor:this.editor,props:e,as:s,className:`node-${this.node.type.name} ${h}`.trim()}),this.editor.on("selectionUpdate",this.handleSelectionUpdate),this.updateElementAttributes()}get dom(){var e;if(this.renderer.element.firstElementChild&&!(!((e=this.renderer.element.firstElementChild)===null||e===void 0)&&e.hasAttribute("data-node-view-wrapper")))throw Error("Please use the NodeViewWrapper component for your node view.");return this.renderer.element}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){const{from:e,to:t}=this.editor.state.selection,r=this.getPos();if(typeof r=="number")if(e<=r&&t>=r+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}}update(e,t,r){const i=o=>{this.renderer.updateProps(o),typeof this.options.attrs=="function"&&this.updateElementAttributes()};if(e.type!==this.node.type)return!1;if(typeof this.options.update=="function"){const o=this.node,p=this.decorations,s=this.innerDecorations;return this.node=e,this.decorations=t,this.innerDecorations=r,this.options.update({oldNode:o,oldDecorations:p,newNode:e,newDecorations:t,oldInnerDecorations:s,innerDecorations:r,updateProps:()=>i({node:e,decorations:t,innerDecorations:r})})}return e===this.node&&this.decorations===t&&this.innerDecorations===r||(this.node=e,this.decorations=t,this.innerDecorations=r,i({node:e,decorations:t,innerDecorations:r})),!0}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.element.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.element.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null}updateElementAttributes(){if(this.options.attrs){let e={};if(typeof this.options.attrs=="function"){const t=this.editor.extensionManager.attributes,r=R.getRenderedAttributes(this.node,t);e=this.options.attrs({node:this.node,HTMLAttributes:r})}else e=this.options.attrs;this.renderer.updateAttributes(e)}}}function xe(n,e){return t=>t.editor.contentComponent?new Ve(n,t,e):{}}exports.BubbleMenu=De;exports.EditorContent=fe;exports.NodeViewWrapper=Ce;exports.ReactNodeViewRenderer=xe;exports.ReactRenderer=te;exports.useEditor=ge;
